function renderGraph(a,b){$("svg").empty();var c={top:30,right:20,bottom:30,left:50},d=$("#chart").width()-c.left-c.right,e=.75*d-c.top-c.bottom,f=d3.time.format("%Y-%m-%d").parse,g=d3.time.scale().range([0,d]),h=d3.scale.linear().range([e,0]),i=d3.svg.axis().scale(g).orient("bottom").ticks(5),j=d3.svg.axis().scale(h).orient("left").ticks(5),k=d3.svg.line().x(function(a){return g(a.date)}).y(function(a){return h(a.close)}),l=d3.select("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")");for(var m in a){for(var n=a[m].dataset.data,o=[],p=0;p<n.length;p++)o.push({date:n[p][0],close:n[p][4]});o.forEach(function(a){a.date=f(a.date),a.close=+a.close}),g.domain(d3.extent(o,function(a){return a.date})),h.domain([0,d3.max(o,function(a){return a.close})]),l.append("path").attr("class","line").attr("stroke",b[m]).attr("d",k(o))}l.append("g").attr("class","x axis").attr("transform","translate(0,"+e+")").call(i),l.append("g").attr("class","y axis").call(j)}function showStockListLoader(){$("#loader").fadeIn()}function hideStockListLoader(){$("#loader").fadeOut()}function renderStockList(a,b){$("#stockListContainer").empty();for(var c in a)if(null!==a[c]){var d=$("<div />",{"class":"row"}),e=$("<div />",{"class":"col-lg-12"}),f=$("<div />",{"class":"panel panel-info"}),g=$("<div />",{"class":"panel-heading",style:"background-color: "+b[c]}),h=$("<h3 />",{"class":"panel-title",text:c.toUpperCase()}),i=$("<div />",{"class":"panel-body",text:a[c].dataset.name}),j=$("<div />",{"class":"panel-footer"}),k=$("<button />",{"class":"btn btn-danger pull-right removeStockButton",text:"Remove ","data-name":c}),l=$("<span />",{"class":"glyphicon glyphicon-trash"}),m=$("<div />",{"class":"clearfix"});$(h).appendTo(g),$(g).appendTo(f),$(i).appendTo(f),$(l).appendTo(k),$(k).appendTo(j),$(m).appendTo(j),$(j).appendTo(f),$(f).appendTo(e),$(e).appendTo(d),$(d).appendTo("#stockListContainer")}}function _getLineColors(a){var b={};for(var c in a)b[c]=_getSingleColor();return b}function _getSingleColor(){var a={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random())};return"rgb("+a.r+","+a.g+","+a.b+")"}$(".alert-danger").click(function(){$(this).fadeOut("slow")});var socket=io(),dataset={},lineColors={};$("form").submit(function(){return""!=$("#stockCode").val()?(socket.emit("addStockCode",$("#stockCode").val()),$("#stockCode").val(""),showStockListLoader(),!1):void 0}),$("body").on("click","button.removeStockButton",function(){var a=$(this).data("name");socket.emit("removeStockCode",a)}),socket.on("error",function(a){hideStockListLoader(),$(".alert-danger").text(a),$(".alert-danger").fadeIn(),setTimeout(function(){$(".alert-danger").fadeOut("slow")},7e3)}),socket.on("globalNotification",function(a){$.isEmptyObject(a)||(dataset=a,console.log(dataset),lineColors=_getLineColors(dataset),renderStockList(dataset,lineColors),renderGraph(dataset,lineColors)),hideStockListLoader()}),socket.on("addStockCodeSucceed",function(a){for(var b in a)dataset[b]=a[b],lineColors[b]=_getSingleColor();renderStockList(dataset,lineColors),renderGraph(dataset,lineColors),hideStockListLoader()}),socket.on("removeStockCodeSucceed",function(a){delete dataset[a],delete lineColors[a],renderStockList(dataset,lineColors),renderGraph(dataset,lineColors),hideStockListLoader()});